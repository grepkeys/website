<!DOCTYPE html>
<html lang="en-au">
  <head>
    {{ partial "head" . }}
    {{ partial "title" . }}
  </head>
  <body>
    {{ partial "nav" . }}

    <header>
      <!-- 'Buy now' button that links to a page to purchase the article's -->
      <!-- product. If applicable, it links to a footnote describing the -->
      <!-- linked product's condition. -->
      {{ if isset .Params "purchase_link" }}
        <p class="buybutton">
          <a href="{{ .Params.purchase_link }}" target="_blank">
            Buy now
          </a>
          <a href="#condition">{{ if isset .Params "condition" }}*{{ end }}</a>
        </p>
      {{ end }}

      <span>{{ .Title }}</span>
    </header>

    <!-- A list of switches the keyboard is available with -->
    {{ if isset .Params "switches" }}
      <section class="switches">
        <!-- Save these vars so that we can access them in ranges later -->
        {{ $site := .Site }}
        {{ $params := .Params }}

        <p>Available with:</p>
          {{ range .Params.switches }}
            <section>
              {{ $manufacturer := . }}

              <!-- Group switches by manufacturer -->
              <p class="manufacturer">{{ .name }}</p>

              {{ range $manufacturer.switches }}
                {{ $switch := . }}
                <div class="switch"><a href="/switches/{{ $switch }}">
                  <!-- Add class with switch name so that we can add switch- -->
                  <!-- specific colours later -->
                  <div class="switchcolourbox {{ $switch }}"></div>

                  <!-- Get short version of switch name if it exists -->
                  {{ $page := $site.GetPage (printf "/switches/%s" $switch) }}
                  {{ if isset $page.Params "short_name" }}
                    <p>{{ $page.Params.short_name }}</p>
                  {{ else }}
                    <p>{{ $page.Title }}</p>
                  {{ end }}
                </a></div>
              {{ end }}
            </section>
          {{ end }}
      </section>
    {{ end }}

    {{ $title := .Title }}

    <main>
      <!-- Image format for e.g. -->
      <!--   /content/keyboards/applewirelesskeyboard.md -->
      <!-- is -->
      <!--   /assets/img/applewirelesskeyboard.jpg -->
      {{ $path := (printf "img/%s.jpg" .File.BaseFileName) }}
      {{ if fileExists (printf "/assets/%s" $path) }}
        <div class="heroimg">
          {{ partial "img" (dict "path" $path "alt" .Title "width" "2048x") }}
        </div>
      {{ end }}

      {{.Content}}

      <!-- Video format is the same as image format, but with .mp4, e.g. -->
      <!--   /content/keyboards/applewirelesskeyboard.md -->
      <!-- is -->
      <!--   /assets/img/applewirelesskeyboard.mp4 -->
      {{ $path := (printf "vid/%s.mp4" .File.BaseFileName) }}
      {{ if fileExists (printf "/assets/%s" $path) }}
        {{ $vid := resources.Get $path }}
        <video controls>
          <source src="{{ $vid.Permalink }}" type="video/mp4">
        </video>
      {{ end }}

      <!-- Footnote from 'Buy now' button. See above ^ -->
      {{ if isset .Params "condition" }}
        <p id="condition">*only available {{ .Params.condition }}</p>
      {{ end }}
    </main>

    {{ partial "footer" . }}
  </body>
</html>
